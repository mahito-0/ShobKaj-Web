<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dropdown Test - ShobKaaj</title>
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/utilities.css">
  <style>
    .test-section {
      margin: 2rem 0;
      padding: 2rem;
      border: 1px solid var(--line);
      border-radius: var(--radius-lg);
      background: var(--surface);
    }
    .test-button {
      margin: 0.5rem;
      padding: 0.75rem 1.5rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius-lg);
      cursor: pointer;
      font-weight: 500;
    }
    .test-button:hover {
      background: var(--primary-hover);
    }
    .test-results {
      margin-top: 1rem;
      padding: 1rem;
      background: var(--surface);
      border-radius: var(--radius);
      border-left: 4px solid var(--primary);
      font-family: monospace;
      font-size: 0.875rem;
    }
  </style>
</head>
<body>
  <nav class="navbar" id="navbar"></nav>
  
  <main class="container">
    <h1>ShobKaaj Dropdown & Profile Test</h1>
    <p>This page is for testing the navbar dropdown functionality and profile access.</p>
    
    <div class="test-section">
      <h2>üîç Debug Tests</h2>
      <p>Click these buttons to run various tests and check the browser console for detailed logs.</p>
      
      <button class="test-button" onclick="runAuthTest()">Test Authentication</button>
      <button class="test-button" onclick="runDropdownTest()">Test Dropdown</button>
      <button class="test-button" onclick="runProfileTest()">Test Profile Access</button>
      <button class="test-button" onclick="enableMockAuth()">Enable Mock Auth</button>
      <button class="test-button" onclick="simulateDropdownClick()">Simulate Dropdown Click</button>
      <button class="test-button" onclick="runFullReport()">Full Debug Report</button>
      
      <div id="testResults" class="test-results" style="display: none;">
        <h3>Test Results:</h3>
        <pre id="testOutput"></pre>
      </div>
    </div>
    
    <div class="test-section">
      <h2>üìã Instructions</h2>
      <ol>
        <li><strong>Open Browser Console:</strong> Press F12 or right-click ‚Üí "Inspect" ‚Üí "Console"</li>
        <li><strong>Enable Mock Auth:</strong> Click "Enable Mock Auth" button and reload the page</li>
        <li><strong>Check Dropdown:</strong> Click on your profile picture in the navbar</li>
        <li><strong>Test Profile:</strong> Click "Profile" in the dropdown menu</li>
        <li><strong>Run Tests:</strong> Use the debug buttons above to diagnose issues</li>
      </ol>
    </div>
    
    <div class="test-section">
      <h2>üîß Quick Fixes</h2>
      <p>If things aren't working:</p>
      <ul>
        <li><strong>No dropdown:</strong> Mock auth might not be enabled. Click "Enable Mock Auth"</li>
        <li><strong>No profile access:</strong> Check console logs, try "Test Profile Access"</li>
        <li><strong>Dropdown not showing:</strong> Try "Simulate Dropdown Click" to test</li>
      </ul>
    </div>
  </main>
  
  <!-- Core Scripts -->
  <script src="/js/api.js"></script>
  <script src="/js/mock-auth.js"></script>
  <script src="/js/i18n.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/main.js"></script>
  <script src="/js/debug-utils.js"></script>
  
  <script>
    // Test functions
    function showResults(message) {
      const resultsDiv = document.getElementById('testResults');
      const output = document.getElementById('testOutput');
      output.textContent = message;
      resultsDiv.style.display = 'block';
      console.log(message);
    }
    
    async function runAuthTest() {
      console.clear();
      showResults('Running authentication test... Check console for details.');
      const user = await __debug.checkAuth();
      showResults(`Auth test complete. User: ${user ? user.name : 'Not authenticated'}`);
    }
    
    function runDropdownTest() {
      console.clear();
      showResults('Running dropdown test... Check console for details.');
      __debug.checkDropdown();
      showResults('Dropdown test complete. Check console and look for red borders on avatars.');
    }
    
    async function runProfileTest() {
      console.clear();
      showResults('Running profile access test... Check console for details.');
      const result = await __debug.testProfileAccess();
      showResults(`Profile test complete. Access: ${result ? 'SUCCESS' : 'FAILED'}`);
    }
    
    function enableMockAuth() {
      __debug.enableMockAuth();
      showResults('Mock auth enabled. Reloading page...');
      setTimeout(() => window.location.reload(), 1000);
    }
    
    function simulateDropdownClick() {
      console.clear();
      showResults('Simulating dropdown click... Check console for details.');
      __debug.simulateDropdownClick();
    }
    
    async function runFullReport() {
      console.clear();
      showResults('Generating full debug report... Check console for details.');
      const report = await __debug.getFullReport();
      showResults(`Full report complete. Authenticated: ${report.authenticated}`);
    }
    
    // Auto-enable mock auth on first visit
    if (!localStorage.getItem('useMockAuth')) {
      console.log('Auto-enabling mock auth for testing...');
      localStorage.setItem('useMockAuth', 'true');
      localStorage.setItem('userId', 'user_123');
      setTimeout(() => window.location.reload(), 1000);
    }
  </script>
</body>
</html>
