version: "3.9"
services:
  app:
    build:
      context: .
      dockerfile: server/Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATA_DIR=/app/data
      - SMTP_HOST=mailhog
      - SMTP_PORT=1025
      - SMTP_SECURE=false
      - FROM_EMAIL=no-reply@shobkaaj.local
      # Optional: provide your own VAPID keys (otherwise auto-generated and saved to /app/data/vapid.json)
      # - VAPID_PUBLIC_KEY=
      # - VAPID_PRIVATE_KEY=
    volumes:
      - data:/app/data
      - uploads:/app/public/uploads
    depends_on:
      - mailhog
    restart: unless-stopped

  mailhog:
    image: mailhog/mailhog:latest
    ports:
      - "8025:8025"   # Web UI
      - "1025:1025"   # SMTP

volumes:
  data:
  uploads:
  